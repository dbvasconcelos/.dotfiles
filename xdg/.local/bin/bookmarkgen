#!/bin/sh

# Generate Named Directories and aliases for bookmarks

user_dirs="${XDG_CONFIG_HOME}/user-dirs.dirs"
# shellcheck source=/dev/null
[ -f "$user_dirs" ] && set -o allexport && . "$user_dirs" && set +o allexport

gtk_bookmarks="${XDG_CONFIG_HOME}/gtk-3.0/bookmarks"

# Remove old files
rm -f "$BOOKMARK_ALIASRC" "$NAMEDDIRRC" "$gtk_bookmarks" 2>/dev/null

# Create new ones
notice="# DO NOT EDIT THIS FILE! It is automatically generated"

{
	echo "$notice"
	echo "# Bookmark Aliases"
	echo 'alias '\\''
} >>"$BOOKMARK_ALIASRC"

if [ -n "$NAMEDDIRRC" ]; then
    {
        echo "$notice"
        echo "# Bookmark Hashes"
    } >>"$NAMEDDIRRC"
fi

# Process Directories
bookmarkdirs="${XDG_CONFIG_HOME}/user-bookmarks.dirs"
envsubst <"${bookmarkdirs}" \
	| awk -v nd="$NAMEDDIRRC" -F= "!/^\s*#/ && !/^\s*\$/ {
		gsub(\"\\\s*#.*$\",\"\");
        printf(\"file://%s %s\n\",\$2,\$1) >> \"$gtk_bookmarks\";
	    printf(\"	%s=\42cd %s && ls -a\42 \\\\\n\",\$1,\$2) >> \"$BOOKMARK_ALIASRC\";
        if (nd) {
            printf(\"hash -d %s=%s \n\",\$1,\$2) >> \"$NAMEDDIRRC\";
        }
	}"

# Process Files
bookmarkfiles="${XDG_CONFIG_HOME}/user-bookmarks.files"
envsubst <"${bookmarkfiles}" \
	| awk -F= "!/^\s*#/ && !/^\s*\$/ {
		gsub(\"\\\s*#.*$\",\"\");
		printf(\"	%s=\42'$EDITOR' %s\42 \\\\\n\",\$1,\$2)  >> \"$BOOKMARK_ALIASRC\" ;
	}"
